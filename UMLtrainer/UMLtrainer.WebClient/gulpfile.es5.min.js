"use strict";var gulp=require("gulp"),plugins=require("gulp-load-plugins")(),runSequence=require("run-sequence"),browserify=require("browserify"),source=require("vinyl-source-stream"),watchify=require("watchify"),tsify=require("tsify"),merge=require("merge-stream"),extensionCss="/**/*.css",extensionLess="/**/*.less",extensionJs="/**/*.js",extensionTs="/**/*.ts",inputApp="./App",inputHtml="./",inpuptHtmlName="index.html",outputFolder="wwwroot",outputBase="./"+outputFolder,outputApp=outputBase+"/app",outputCss=outputBase+"/css/",outputLib=outputBase+"/lib",customCssOutput=outputCss+extensionCss,tsFormatterConfig={formatter:"msbuild"},tsReporterConfig={emitError:!1,summarizeFailureOutput:!0},builder=browserify({basedir:"./",debug:!0,entries:[inputApp+"/app.ts"],cache:{},packageCache:{},plugin:[tsify,watchify]}),bundle=function(n){var t,i;return(plugins.util.log(plugins.util.colors.yellow("Starting ts build...")),t=builder.bundle().on("error",plugins.util.log).pipe(source("app.js")).pipe(gulp.dest(outputApp)),n)?(i=gulp.src(n).pipe(plugins.tslint(tsFormatterConfig)).pipe(plugins.tslint.report(tsReporterConfig)),merge(i,t)):t};gulp.task("build",function(){return runSequence("clean","css:less","inject")});gulp.task("clean",function(){return gulp.src([outputCss],{read:!1}).pipe(plugins.clean({force:!0}))});gulp.task("ts:startup",function(){builder.on("update",bundle);builder.on("log",plugins.util.log);bundle()});gulp.task("ts:build",function(){return bundle()});gulp.task("ts:lint",function(){return gulp.src(inputApp+extensionTs).pipe(plugins.tslint(tsFormatterConfig)).pipe(plugins.tslint.report(tsReporterConfig))});gulp.task("css:less",function(){return gulp.src(inputApp+extensionLess).pipe(plugins.less()).pipe(plugins.flatten()).pipe(gulp.dest(outputCss))});gulp.task("css:watch",function(){return gulp.watch(inputApp+extensionLess,["css:less"])});gulp.task("inject",function(){return gulp.src(inputHtml+inpuptHtmlName).pipe(plugins.inject(gulp.src(customCssOutput),{addRootSlash:!1,ignorePath:outputFolder+"/"})).pipe(gulp.dest(outputBase))});